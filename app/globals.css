@tailwind base;
@tailwind components;
@tailwind utilities;

@import './grid-layout.css';

@layer base {
  html,
  body {
    height: 100%;
    overflow-x: hidden;
  }
  
  body {
    margin: 0;
    padding: 0;
  }

  /* Cacher les scrollbars mais garder la fonctionnalité */
  * {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
  }

  *::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  *::-webkit-scrollbar-track {
    background: transparent;
  }

  *::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 4px;
  }

  *:hover::-webkit-scrollbar-thumb {
    background: hsl(var(--muted-foreground) / 0.2);
  }

  *::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--muted-foreground) / 0.3);
  }
  
  :root {
    /* Backgrounds */
    --background: 0 0% 100%;
    --foreground: 0 0% 3.9%;
    
    /* Cards & Surfaces */
    --card: 0 0% 100%;
    --card-foreground: 0 0% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 3.9%;
    
    /* Primary Action */
    --primary: 221 83% 53%;
    --primary-foreground: 0 0% 100%;
    
    /* Secondary Elements */
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 9%;
    
    /* Muted Elements */
    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;
    
    /* Accent */
    --accent: 0 0% 93%;
    --accent-foreground: 0 0% 9%;
    
    /* Selection/Active State */
    --selected: 221 83% 53%;
    --selected-foreground: 0 0% 100%;
    
    /* Destructive */
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    
    /* Borders & Inputs */
    --border: 0 0% 89.8%;
    --input: 0 0% 96.1%;
    --ring: 221 83% 53%;
    --radius: 0.5rem;
    
    /* Charts */
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
  }

  .dark {
    /* Backgrounds */
    --background: 0 0% 9%;
    --foreground: 0 0% 98%;
    
    /* Cards & Surfaces - Input aligné sur card */
    --card: 0 0% 12%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 12%;
    --popover-foreground: 0 0% 98%;
    
    /* Primary Action - Accent bleu visible */
    --primary: 217 91% 60%;
    --primary-foreground: 0 0% 100%;
    
    /* Secondary Elements */
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    
    /* Muted Elements */
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 70%;
    
    /* Accent - Surface interactive */
    --accent: 0 0% 20%;
    --accent-foreground: 0 0% 98%;
    
    /* Selection/Active State */
    --selected: 217 91% 60%;
    --selected-foreground: 0 0% 100%;
    
    /* Destructive */
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    
    /* Borders & Inputs - Input = Card pour cohérence */
    --border: 0 0% 20%;
    --input: 0 0% 12%;
    --ring: 0 0% 83.1%;
    
    /* Charts */
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }

  .oled {
    /* Backgrounds - Pure Black */
    --background: 0 0% 0%;
    --foreground: 0 0% 98%;
    
    /* Cards & Surfaces - Input aligné sur card */
    --card: 0 0% 5%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 5%;
    --popover-foreground: 0 0% 98%;
    
    /* Primary Action - Accent bleu visible */
    --primary: 217 91% 60%;
    --primary-foreground: 0 0% 100%;
    
    /* Secondary Elements */
    --secondary: 0 0% 10%;
    --secondary-foreground: 0 0% 98%;
    
    /* Muted Elements */
    --muted: 0 0% 10%;
    --muted-foreground: 0 0% 75%;
    
    /* Accent - Surface interactive */
    --accent: 0 0% 15%;
    --accent-foreground: 0 0% 98%;
    
    /* Selection/Active State */
    --selected: 217 91% 60%;
    --selected-foreground: 0 0% 100%;
    
    /* Destructive */
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    
    /* Borders & Inputs - Input = Card pour cohérence */
    --border: 0 0% 14.9%;
    --input: 0 0% 5%;
    --ring: 0 0% 83.1%;
    
    /* Charts */
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
    font-feature-settings: "liga" 1, "calt" 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }
  
  /* Improved contrast for headings */
  h1, h2, h3, h4, h5, h6 {
    @apply text-foreground;
    font-weight: 600;
    letter-spacing: -0.02em;
  }
  
  /* Better readability for paragraphs */
  p {
    line-height: 1.7;
  }
  
  /* Improved link visibility */
  :root a:not(.cyber a) {
    color: hsl(var(--primary));
    text-decoration: none;
    transition: all 0.2s ease;
  }
  
  :root a:not(.cyber a):hover {
    opacity: 0.8;
    text-decoration: underline;
  }
  
  .dark a:not(.cyber a),
  .oled a:not(.cyber a) {
    color: hsl(var(--foreground));
    text-decoration: none;
    transition: all 0.2s ease;
  }
  
  .dark a:not(.cyber a):hover,
  .oled a:not(.cyber a):hover {
    opacity: 0.8;
    text-decoration: underline;
  }
  
  /* Better contrast for disabled elements */
  :disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  /* Improved focus visibility */
  :focus-visible {
    @apply ring-2 ring-ring ring-offset-2 ring-offset-background;
    outline: none;
  }
  
  /* Better contrast for dialogs and modals */
  [role="dialog"] {
    @apply bg-card text-card-foreground;
  }
  
  /* Force proper text colors in dialogs for all themes - exclude cyber */
  :root [role="dialog"] label:not(.cyber label),
  :root [role="dialog"] p:not(.cyber p),
  :root [role="dialog"] span:not(.text-muted-foreground):not(.cyber span),
  .dark [role="dialog"] label:not(.cyber label),
  .dark [role="dialog"] p:not(.cyber p),
  .dark [role="dialog"] span:not(.text-muted-foreground):not(.cyber span),
  .oled [role="dialog"] label:not(.cyber label),
  .oled [role="dialog"] p:not(.cyber p),
  .oled [role="dialog"] span:not(.text-muted-foreground):not(.cyber span) {
    color: hsl(var(--foreground));
  }
  
  [role="dialog"] .text-muted-foreground:not(.cyber .text-muted-foreground) {
    color: hsl(var(--muted-foreground));
    opacity: 1;
  }
  
  /* Fix input contrast - only for non-cyber themes */
  :root input:not(.cyber input),
  :root textarea:not(.cyber textarea),
  :root select:not(.cyber select),
  .dark input:not(.cyber input),
  .dark textarea:not(.cyber textarea),
  .dark select:not(.cyber select),
  .oled input:not(.cyber input),
  .oled textarea:not(.cyber textarea),
  .oled select:not(.cyber select) {
    background: hsl(var(--input));
    color: hsl(var(--foreground));
    border-color: hsl(var(--border));
  }
  
  :root input::placeholder,
  :root textarea::placeholder,
  .dark input::placeholder,
  .dark textarea::placeholder,
  .oled input::placeholder,
  .oled textarea::placeholder {
    color: hsl(var(--muted-foreground));
    opacity: 0.6;
  }
  
  /* Explicit textarea styling to override browser defaults */
  :root textarea,
  .dark textarea,
  .oled textarea {
    background: hsl(var(--input)) !important;
    color: hsl(var(--foreground)) !important;
    border-color: hsl(var(--border)) !important;
  }
  
  [role="dialog"] input,
  [role="dialog"] textarea,
  [role="dialog"] select {
    background: hsl(var(--input));
    color: hsl(var(--foreground));
    border-color: hsl(var(--border));
  }
  
  [role="dialog"] input::placeholder,
  [role="dialog"] textarea::placeholder {
    color: hsl(var(--muted-foreground));
    opacity: 0.6;
  }
  
  /* Fix select trigger in dialogs */
  [role="dialog"] button[role="combobox"] {
    background: hsl(var(--input));
    color: hsl(var(--foreground));
    border-color: hsl(var(--border));
  }
  
  /* Improved button contrast for non-cyber themes */
  :root button[data-state="active"]:not(.cyber button),
  .dark button[data-state="active"]:not(.cyber button),
  .oled button[data-state="active"]:not(.cyber button) {
    background: hsl(var(--accent));
    color: hsl(var(--accent-foreground));
  }
  
  /* OLED-specific overrides for better contrast */
  .oled .bg-yellow-50 {
    background-color: rgba(202, 138, 4, 0.3) !important;
  }
  
  .oled .bg-yellow-500\/10 {
    background-color: rgba(234, 179, 8, 0.15) !important;
  }
  
  .oled .bg-red-50 {
    background-color: rgba(220, 38, 38, 0.3) !important;
  }
  
  .oled .border-yellow-200 {
    border-color: rgba(202, 138, 4, 0.5) !important;
  }
  
  .oled .border-yellow-500\/30 {
    border-color: rgba(234, 179, 8, 0.3) !important;
  }
  
  .oled .border-red-200 {
    border-color: rgba(220, 38, 38, 0.5) !important;
  }
  
  .oled .text-yellow-800 {
    color: rgb(254, 243, 199) !important;
  }
  
  .oled .text-yellow-900 {
    color: rgb(254, 243, 199) !important;
  }
  
  .oled .text-red-600 {
    color: rgb(252, 165, 165) !important;
  }
  
  .oled .text-red-700 {
    color: rgb(254, 202, 202) !important;
  }
  
  /* Better hover states for light theme */
  :root button:hover:not(:disabled):not(.cyber button),
  :root a:hover:not(:disabled):not(.cyber a) {
    opacity: 0.9;
  }
  
  .dark button:hover:not(:disabled):not(.cyber button),
  .oled button:hover:not(:disabled):not(.cyber button) {
    opacity: 0.9;
  }
  
  /* Better visibility for TabsTrigger in cyber themes */
  .cyber [role="tab"][data-state="active"] {
    background: var(--cyber-primary) !important;
    color: rgba(0, 0, 0, 0.95) !important;
    font-weight: 600;
    text-shadow: none;
  }
  
  .cyber.matrix [role="tab"][data-state="active"] {
    background: var(--cyber-primary) !important;
    color: rgba(0, 0, 0, 0.95) !important;
    font-weight: 600;
    text-shadow: none;
  }
  
  .cyber.synthwave [role="tab"][data-state="active"] {
    background: var(--cyber-primary) !important;
    color: rgba(255, 255, 255, 0.98) !important;
    font-weight: 600;
  }
  
  .cyber.arctic [role="tab"][data-state="active"] {
    background: var(--cyber-primary) !important;
    color: rgba(255, 255, 255, 0.98) !important;
    font-weight: 600;
  }
  
  /* Better link buttons in navbar */
  nav a {
    transition: all 0.2s ease;
  }
  
  /* Improved readability for Matrix theme */
  .cyber.matrix {
    color: rgba(0, 255, 65, 0.95);
  }
  
  .cyber.matrix .text-muted-foreground {
    color: rgba(0, 255, 65, 0.65) !important;
  }
  
  .cyber.matrix input,
  .cyber.matrix textarea {
    background: rgba(0, 255, 65, 0.06) !important;
    border-color: rgba(0, 255, 65, 0.25) !important;
    color: rgba(0, 255, 65, 0.95) !important;
  }
  
  .cyber.matrix input::placeholder,
  .cyber.matrix textarea::placeholder {
    color: rgba(0, 255, 65, 0.45) !important;
  }
  
  /* Improved readability for Synthwave theme */
  .cyber.synthwave input,
  .cyber.synthwave textarea {
    background: rgba(255, 255, 255, 0.12) !important;
    border-color: rgba(255, 255, 255, 0.25) !important;
    color: rgba(255, 255, 255, 0.98) !important;
  }
  
  .cyber.synthwave input::placeholder,
  .cyber.synthwave textarea::placeholder {
    color: rgba(255, 255, 255, 0.60) !important;
  }
  
  /* Improved readability for Arctic theme */
  .cyber.arctic input,
  .cyber.arctic textarea {
    background: rgba(255, 255, 255, 0.30) !important;
    border-color: rgba(0, 188, 212, 0.35) !important;
    color: rgba(0, 77, 64, 0.95) !important;
  }
  
  .cyber.arctic input::placeholder,
  .cyber.arctic textarea::placeholder {
    color: rgba(0, 77, 64, 0.55) !important;
  }
  
  /* Improved readability for Cyber Blue theme */
  .cyber input:not(.cyber.matrix input):not(.cyber.synthwave input):not(.cyber.arctic input),
  .cyber textarea:not(.cyber.matrix textarea):not(.cyber.synthwave textarea):not(.cyber.arctic textarea) {
    background: rgba(255, 255, 255, 0.09) !important;
    border-color: rgba(255, 255, 255, 0.18) !important;
    color: rgba(255, 255, 255, 0.95) !important;
  }
  
  .cyber input:not(.cyber.matrix input):not(.cyber.synthwave input):not(.cyber.arctic input)::placeholder,
  .cyber textarea:not(.cyber.matrix textarea):not(.cyber.synthwave textarea):not(.cyber.arctic textarea)::placeholder {
    color: rgba(255, 255, 255, 0.52) !important;
  }

  /* ====================================
     CATÉGORIES - Améliorations visuelles
     ==================================== */
  
  /* Animation smooth lors du collapse/expand */
  .category-content {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Effet hover sur zone de drag de catégorie - ISOLÉ */
  .category-drag-handle {
    transition: all 0.2s ease;
    z-index: 10;
  }
  
  .category-drag-handle:hover {
    transform: scale(1.05);
  }
  
  .category-drag-handle:active {
    transform: scale(0.95);
  }

  /* IMPORTANT: Empêcher la propagation du drag de la catégorie aux widgets */
  .category-grid .react-grid-item {
    pointer-events: auto;
  }

  .category-grid .widget-drag-handle {
    z-index: 20; /* Plus élevé que category-drag-handle */
    position: relative;
  }

  /* Isoler complètement les zones de drag */
  .react-grid-item.react-dragging .widget-drag-handle {
    cursor: grabbing !important;
  }

  /* Empêcher le parent de capturer les events du child */
  .category-grid .react-grid-item:hover {
    z-index: 10;
  }

  /* CRITIQUE: Zone interne de catégorie ne doit JAMAIS être draggable par le parent */
  .category-inner-zone {
    pointer-events: auto !important;
    touch-action: auto !important;
  }

  /* Les widgets dans une catégorie ne doivent pas trigger le drag de la catégorie */
  .category-widget-item {
    pointer-events: auto !important;
  }

  /* La poignée de catégorie doit être la SEULE chose qui drag la catégorie */
  .category-drag-handle {
    pointer-events: auto !important;
    touch-action: none !important;
    z-index: 15;
  }

  /* Empêcher absolument le drag sur tout sauf les handles */
  .react-grid-item > div:not(.category-drag-handle) {
    user-select: none;
  }

  /* Le conteneur de catégorie ne doit PAS être draggable sauf via sa poignée */
  .category-container {
    pointer-events: none;
  }

  /* Réactiver les pointer-events pour les éléments internes */
  .category-container > * {
    pointer-events: auto;
  }

  /* Header de catégorie: seulement la poignée est draggable */
  .category-container .category-drag-handle {
    pointer-events: auto !important;
    cursor: grab;
  }

  .category-container .category-drag-handle:active {
    cursor: grabbing;
  }

  /* CRITIQUE: La zone interne de la catégorie NE DOIT PAS être capturée par le parent */
  .category-inner-zone,
  .category-content {
    pointer-events: auto !important;
    touch-action: auto !important;
  }

  /* Les widgets dans une catégorie sont complètement isolés du parent */
  .category-grid .react-grid-item {
    pointer-events: auto !important;
  }

  .category-grid .widget-drag-handle {
    cursor: grab !important;
    z-index: 20;
    pointer-events: auto !important;
  }

  .category-grid .widget-drag-handle:active {
    cursor: grabbing !important;
  }

  /* Empêcher la grille principale de capturer les events dans les catégories */
  .main-dashboard-grid > .react-grid-item > .category-grid-wrapper {
    isolation: isolate;
  }

  .main-dashboard-grid > .react-grid-item > .category-grid-wrapper * {
    pointer-events: auto;
  }
  
  /* Zone de drop pour widgets */
  .widget-drop-zone {
    position: relative;
  }
  
  /* Amélioration visuelle en mode édition */
  .react-grid-item.react-grid-placeholder {
    background: hsl(var(--primary) / 0.15) !important;
    border: 2px dashed hsl(var(--primary) / 0.5) !important;
    border-radius: 0.75rem;
    transition: all 0.2s ease;
  }
  
  /* Animation lors du drag */
  .react-grid-item.react-dragging {
    opacity: 0.8;
    z-index: 100;
    transition: none;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
  
  /* Scroll smooth dans les catégories */
  .widget-drop-zone {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--muted-foreground) / 0.2) transparent;
  }
  
  .widget-drop-zone::-webkit-scrollbar {
    width: 6px;
  }
  
  .widget-drop-zone::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .widget-drop-zone::-webkit-scrollbar-thumb {
    background: hsl(var(--muted-foreground) / 0.2);
    border-radius: 3px;
  }
  
  .widget-drop-zone::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--muted-foreground) / 0.3);
  }

  /* Grille imbriquée dans les catégories */
  .category-grid {
    min-height: 120px;
  }

  .category-grid .react-grid-item {
    transition: all 0.2s ease;
  }

  .category-grid .react-grid-item.react-grid-placeholder {
    background: hsl(var(--primary) / 0.1) !important;
    border: 2px dashed hsl(var(--primary) / 0.4) !important;
    border-radius: 0.5rem;
  }

  /* Animation plus fluide pour les grilles imbriquées */
  .category-content {
    transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Effet grille décoratif */
  .bg-grid-white {
    background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
  }
}

/* Cache la scrollbar quand elle n'est pas utilisée */
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}